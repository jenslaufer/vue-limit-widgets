(function(s,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(s=typeof globalThis<"u"?globalThis:s||self,o(s.VueLimitWidgets={},s.Vue))})(this,(function(s,o){"use strict";const m=typeof chrome<"u"&&chrome.storage?.local,x=typeof globalThis<"u"&&globalThis.localStorage&&typeof globalThis.localStorage=="object",l=async t=>{if(m)return(await chrome.storage.local.get(t))[t]??null;if(x){const e=localStorage.getItem(t);return e===null?null:JSON.parse(e)}throw new Error("No supported storage backend available")},p=async(t,e)=>{if(m){await chrome.storage.local.set({[t]:e});return}if(x){localStorage.setItem(t,JSON.stringify(e));return}throw new Error("No supported storage backend available")},u="n8eneere88chbpbp8766bc97",d=t=>btoa(String.fromCodePoint(...new TextEncoder().encode(JSON.stringify(t)).map((e,a)=>e^u.codePointAt(a%u.length)))),y=t=>{try{const e=new Uint8Array(atob(t).split("").map((a,i)=>a.codePointAt(0)^u.codePointAt(i%u.length)));return JSON.parse(new TextDecoder().decode(e))}catch(e){return console.warn("Failed to decrypt data:",e.message),null}},Q=async t=>{const e=await l(t);return e?y(e):null},h=async(t,e)=>{const a=d(e);return p(t,a)},N=async t=>{const e=await l(t);return e?y(e):null},f=async(t,e)=>{const a=d(e);return p(t,a)},S={__name:"Quota",props:{quotaName:{type:String,default:"quota"},maxQuotaName:{type:String,default:"maxQuota"},maxQuota:{type:Number,required:!0}},setup(t){const e=t,a=o.ref(0),i=o.ref(0),r=async()=>{const n=await N(e.maxQuotaName),c=n??e.maxQuota;n===null&&await f(e.maxQuotaName,e.maxQuota),i.value=c},w=async()=>{const n=await Q(e.quotaName)??0,c=Number(n)<=i.value?Number(n)+1:Number(n);await h(e.quotaName,c),a.value=c};return o.watch(()=>e.maxQuota,async n=>{i.value=n,await f(e.maxQuotaName,n)}),o.onMounted(async()=>{await r(),await w()}),(n,c)=>a.value<=i.value?o.renderSlot(n.$slots,"withinQuota",{key:0}):o.renderSlot(n.$slots,"exceededQuota",{key:1})}},b=async t=>{const e=await l(t);return e?y(e):null},g=async(t,e)=>{const a=d(e);return p(t,a)},E={__name:"Expiry",props:{expiry:{type:String},expiryName:{type:String,default:"expiry"}},setup(t){const e=t,a=o.ref(new Date),i=o.ref(new Date);return o.watch(()=>e.expiry,async r=>{a.value=new Date(r),await g(e.expiryName,r)}),o.onMounted(async()=>{console.log("Expiry",e.expiry);const r=await b(e.expiryName);r?(console.log("Using saved expiry:",r),a.value=new Date(r)):(console.log("Using initial expiry:",e.expiry),a.value=new Date(e.expiry),await g(e.expiryName,e.expiry))}),(r,w)=>i.value<=a.value?o.renderSlot(r.$slots,"withinExpiry",{key:0}):o.renderSlot(r.$slots,"exceededExpiry",{key:1})}};s.Expiry=E,s.Quota=S,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));
